// Copyright 2024. Increase BV. All Rights Reserved.
//
// Created By: Digital Oasis
// for Increase B.V.
//
// Created: 04-03-2024
// Last update: 
//
// ABOUT THE SCRIPT
// This script will exports RSA and assets performance and the corresponding fields.
// 
// 
//


var config = {
  
  LOG : true,
  
  // Make a copy of this script and copy the URL: https://docs.google.com/spreadsheets/d/1WvNSbaZi2dz3Uu74AIniKy5YLHctZ_6c6i0Gp2DQ8ns/copy
  SPREADSHEET_URL : "https://docs.google.com/spreadsheets/d/1DMj-4pIDO1VMzGbFq2Mv6XtwpA8H875hZEGkhH3P8Ic/edit#gid=0",
  SHEET_NAME : ["RSA","AssetsPerformance"],
  QA_Query : [ "SELECT CampaignName, AdGroupName, Id, AdStrengthInfo " +
    "FROM AD_PERFORMANCE_REPORT " +
    "WHERE AdType = RESPONSIVE_SEARCH_AD " +
    "AND CampaignStatus = ENABLED " +
    "AND AdGroupStatus = ENABLED " +
    "AND Status = ENABLED", "SELECT campaign.name, asset_group.name, asset.text_asset.text, asset_group_asset.field_type, asset_group_asset.performance_label FROM asset_group_asset"]
  
}


function main() {
  
  if(config.SPREADSHEET_URL == "https://"){
    throw Error("Make a copy of the sheet and paste the URL in the config \nhttps://docs.google.com/spreadsheets/d/1WvNSbaZi2dz3Uu74AIniKy5YLHctZ_6c6i0Gp2DQ8ns/copy");
  }  
  
  var ss = SpreadsheetApp.openByUrl(config.SPREADSHEET_URL);
  for (let i=1; i < config.SHEET_NAME.length; i++){
    
    var sheet = ss.getSheetByName(config.SHEET_NAME[i]);

    var report = AdsApp.report(config.QA_Query[i]);
    
    // Export data and clean up sheet
    sheet.clearContents();
    report.exportToSheet(sheet);
    sheet.autoResizeColumns(1, sheet.getLastColumn());
  
  if(sheet.getMaxColumns() - sheet.getLastColumn() != 0){
    sheet.deleteColumns(sheet.getLastColumn() + 1, sheet.getMaxColumns() - sheet.getLastColumn());
  }
  }
  if(config.LOG === true){
    
    var rows = report.rows();
    while(rows.hasNext()){
      var row = rows.next();

      Logger.log("Campaign: " + row["campaign.name"] + " - Adgroup: " + row["asset_group.name"] + " - " + row["asset_group.ad_strength"]);
    } // rowIterator
    
  }
  
  Logger.log("Export completed");
  
} // function main()
